# METABEGIN
# X-Env-Layer-Name: login
# X-Env-Layer-Category: layer
# X-Env-Layer-Desc: Install Login, creates user and installs any dev tools
# X-Env-Layer-Requires: v8-svelte
#
# X-Env-VarRequires: IGconf_device_user1
# X-Env-VarRequires-Valid: string
#
# X-Env-VarOptional: IGconf_device_user1pass
# METAEND
---
mmdebstrap:
  packages:
    - passwd
    - libpam-runtime
    - login
    # dev tools (comment out for production)
    - nano
    - ncurses-term

  customize-hooks:
    - chroot $1 sh -c "useradd -m -s /bin/bash -u 4000 $IGconf_device_user1"

    - |-
      if [ -n "$IGconf_device_user1pass" ] ; then
         chroot $1 sh -c "printf '%s:%s\n' '${IGconf_device_user1}' '${IGconf_device_user1pass}' | chpasswd"
      fi

    - chroot $1 sh -c "echo 'root:Fo0bar!!' | chpasswd"

    # dev tools (comment out for production)
    - chroot $1 sh -c "echo 'export TERM=xterm' >> /etc/profile.d/term.sh"
